!function(e){function a(){_.extend(_.templateSettings,t)}var t={interpolate:/<%-([\s\S]+?)%>/g,escape:/<%=([\s\S]+?)%>/g,variable:"data"};a();var i={},r={};i.header=function(){var e=$('<div class="header-component"></div>');return e.on("click","a",function(e){e.preventDefault();var a=$(e.target),t="action."+a.data("trigger"),i=a.attr("href");EC.trigger(t,i)}),{render:function(a){var t=r.headerTemplate(a);return e.html(t),e}}},i.author=function(){var e=$('<div class="author-component"></div>');return e.on("click","li",function(e){var a=$(e.target),t="action."+a.data("trigger"),i=a.data("name");EC.trigger(t,i)}),{render:function(a){var t=r.authorTemplate(a);return e.html(t),e}}},i.book=function(){var e=$('<div class="book-component"></div>');return e.on("click","a",function(e){var a=$(e.target),t="action."+a.data("trigger");if("action.addToCart"==t){var i=a.closest("li"),r=a.data("id"),n=i.find("h2").text(),c=a.data("priceorigin"),d=a.data("pricefinal"),l=a.data("company"),o=i.find("img").attr("src");EC.trigger(t,[r,n,c,d,l,o])}else if("action.getMore"==t){var m=a.data("page");EC.trigger(t,m)}}),{render:function(a){var t=r.bookTemplate(a);return e.html(t),e}}},i.moreItems=function(){return{html:function(e){var a=r.moreItemsTemplate(e);return a}}},i.simpleCartBar=function(){var e=$('<div class="simple-cart-bar-component"></div>');return{render:function(a){var t=r.simpleCartBarTemplate(a);return e.html(t),e}}},i.cart=function(){var e=$('<div class="cart-component"></div>');return e.on("click","a",function(e){var a=$(e.target),t="action."+a.data("trigger"),i=a.data("change"),r=a.data("id");EC.trigger(t,[i,r])}),{render:function(a){var t=r.cartTemplate(a);return e.html(t),e}}},i.order=function(){var e=$('<div class="order-component"></div>');return{render:function(a){var t=r.orderTemplate(a);return e.html(t),e}}},r={headerTemplate:_.template('<a href="<%=data.backLink%>" class="back" data-trigger="changeRouter">返回</a><h1><%= data.pageTitle%></h1>'),authorTemplate:_.template('<ul><% $.each(__data.authors, function(index, item) {%><% if(data.selected == item) {%><li data-name="<%= item%>" class="tab-active" data-trigger="changeAuthor"><%= item%></li><%}else{%><li data-name="<%= item%>" data-trigger="changeAuthor"><%= item%></li><%}%><%}) %></ul>'),bookTemplate:_.template('<ul><%$.each(data.list, function(index, item){%><li><img src="<%= item.images%>"><h2><%= item.name%></h2><p><%= item.price.final%></p><del><%= item.price.origin%></del><a href="###" data-trigger="addToCart" data-id="<%= item.objectId%>" data-priceOrigin="<%= item.price.origin%>" data-priceFinal="<%= item.price.final%>" data-company="<%= item.company%>">借书吧</a></li><%})%></ul><% if (data.more) {%><a class="more" data-trigger="getMore" data-page="<%=data.page%>">更多</a><%}%>'),moreItemsTemplate:_.template('<%$.each(data, function(index, item){%><li><img src="<%= item.images%>"><h2><%= item.name%></h2><p><%= item.price.final%></p><del><%= item.price.origin%></del><a href="###" data-trigger="addToCart" data-id="<%= item.objectId%>" data-priceOrigin="<%= item.price.origin%>" data-priceFinal="<%= item.price.final%>">借书吧</a></li><%})%>'),simpleCartBarTemplate:_.template('<div class="stick-bar">共<%= data.num%>本书，共<%= data.price%>元<% var href = data.price ? "#/cart" : "###"%><a href="<%= href%>" class="">去结算</a></div>'),cartTemplate:_.template('<div class="cart"><%var totalPrice = 0%><%var feesTotalPrice = 0%><% $.each(data.list, function(company, items){ %><%if (company != "undefined"){%><div class="cart-container"><%var cartPrice = 0%><% var thisCompany = _.where(__data.company, {objectId: company})[0]%><h2><%= thisCompany.name%></h2><ul><%$.each(items, function(index, item){%><%if (item.num > 0) {%><% var itemTotalPrice = item.num * item.finalPrice%><% cartPrice += itemTotalPrice%><li><img src="<%= item.images%>"><h2><%= item.name%></h2><p><%= item.finalPrice%></p><div class="count-container"><div class="counter"><a href="###" data-trigger="changeNum" data-change="add" data-id="<%= item.id%>">+</a></li><span><%= item.num%></span><a href="###" data-trigger="changeNum" data-change="reduce" data-id="<%= item.id%>" >-</a></li></div><span>小计：</span><strong><%= itemTotalPrice%></strong></div></li><%}%><%})%></ul><% var free = thisCompany.delivery.free%><% fees = thisCompany.delivery.fees%><p class="cart-info"><%if (cartPrice < free) {%><% feesTotalPrice += fees%><span>运费<%=thisCompany.delivery.fees%> 元，购物满<%= free%>元免运费</span><span>￥<%=cartPrice + fees%></span>(含运费￥<%=fees%>)</p><%} else {%><% fees = 0%><span>￥<%=cartPrice%></span>(免运费)</p><%}%><% totalPrice += cartPrice + fees%></div><%}%><%})%></div><div class="stick-bar"><%= totalPrice%>元,共计<%= data.num%>件<%if (feesTotalPrice) {%><% itemData.total.fees = feesTotalPrice%><span>含运费￥<%= feesTotalPrice%></span><%}else{%><span>免运费</span><%}%><% var href = totalPrice ? "#/order" : "###"%><a href="<%= href%>" class="">结算</a></div>'),orderTemplate:_.template('<div class="container"><h2>收货信息</h2><div class="line"><%=data.campus.name%></div><div class="line"><label>地址</label><input id="address" type="text" placeholder="请输入您需要配送的地址"/></div><div class="line"><label>手机号码</label><input id="mobile" type="text" placeholder="请输入您的手机号码"/></div></div><div class="container"><h2>支付方式</h2><div class="line">货到付款</div></div><div class="container"><% $.each(data.list, function(company, items){ %><%if (company != "undefined"){%><div class="cart-container"><% var thisCompany = _.where(__data.company, {objectId: company})[0]%><h2><%= thisCompany.name%></h2><ul><%$.each(items, function(index, item){%><%if (item.num > 0) {%><li><img src="<%= item.images%>"><h2><%= item.name%></h2><div><p>￥<%= item.finalPrice%></p><p>x <%= item.num%></p></div></li><%}%><%})%></ul></div><%}%><%})%><div class="line"><label>配送时间</label><select id="time"><option value="">请选择您需要配送的时间段</option><%$.each(data.campus.delivery, function(index, time){%><option value="<%=time%>"><%=time%></option><%})%></select></div><div class="line"><input id="remarks" placeholder="给卖家留言："/></div><div class="line"><p>共<%= data.total.num%>件商品 合计：￥<%=data.total.price + data.total.fees%></p></div><div class="line"><p>运费：￥<%= data.total.fees%></p></div></div>')},e.Component=i}(window);