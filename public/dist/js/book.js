!function(){function e(){p.append(f.render(itemData.pageInfo))}function t(){g.append(D.render({selected:itemData.pageInfo.author}))}function a(){l.append(C.render(__data.books))}function i(){var e=l.find(".more"),t=v.html(__data.books.list);$(t).insertBefore(e),__data.books.more?e.data("page",__data.books.page):e.remove()}function n(){u.append(h.render({num:itemData.total.num,price:itemData.total.price}))}function o(){itemData.pageInfo.pageTitle=itemData.selected.campus.name,s.show(),e(),t(),a(),n()}function r(){itemData.pageInfo.pageTitle="购物车",itemData.pageInfo.backLink="list";var t=_.keys(_.groupBy(itemData.selected.items,"company"));"undefined"!=t?(c.append(y.render({list:_.groupBy(itemData.selected.items,"company"),num:itemData.total.num})),e(),c.show()):(c.hide(),B.setRoute("list"))}function m(){itemData.pageInfo.pageTitle="确认订单",itemData.pageInfo.backLink="cart";var t=_.keys(_.groupBy(itemData.selected.items,"company"));"undefined"!=t?(d.append(b.render({list:_.groupBy(itemData.selected.items,"company"),total:itemData.total,campus:itemData.selected.campus})),e(),c.hide(),d.show()):(c.hide(),B.setRoute("list"))}itemData={selected:{items:{},campus:{key:"999",name:"蛋蛋大学",business:"10:00,24:00",delivery:["中午：12:30 ~ 13:30","下午：16:30 ~ 17:30","晚上：20:30 ~ 21:30"]}},pageInfo:{author:"鲁迅",page:"xxx",pageTitle:"书架",backLink:"###"},total:{price:0,fees:0,num:0}},__data={authors:["郁达夫","鲁迅"],company:[{objectId:"12345sss",name:"蛋蛋之家",delivery:{fees:5,free:40}},{objectId:"23456aaa",name:"otherFamily",delivery:{fees:10,free:20}}],books:{page:1,more:!0,list:[{objectId:11111,name:"狂人日记",images:"/img/1.png",price:{origin:30,"final":28},company:"12345sss"},{objectId:222,name:"呐喊",images:"/img/2.png",price:{origin:20,"final":18},company:"12345sss"},{objectId:333,name:"阿Q正传",images:"/img/3.png",price:{origin:40,"final":32},company:"23456aaa"}]}},console.log("test");var s=$(".book-list-page"),c=$(".cart-page"),d=$(".order-page"),p=$(".header"),g=$(".author"),l=$(".bookList"),u=$(".simple-cart"),f=Component.header(),D=Component.author(),C=Component.book(),h=Component.simpleCartBar(),v=Component.moreItems(),y=Component.cart(),b=Component.order();window.EC=$({}),EC.on("action.changeRouter",function(e,t){switch(t){case"list":B.setRoute("list"),EC.trigger("view.renderList"),c.hide(),d.hide();break;case"cart":B.setRoute("cart"),EC.trigger("view.renderCart"),d.hide(),s.hide()}}),EC.on("action.changeAuthor",function(e,t){t!=itemData.pageInfo.author&&(itemData.pageInfo.author=t,EC.trigger("view.renderList"))}),EC.on("action.getMore",function(){var e={page:2,more:!1,list:[{objectId:4444,name:"春天",images:"/img/4.png",price:{origin:30,"final":28},company:"12345sss"},{objectId:555,name:"夏天",images:"/img/5.png",price:{origin:20,"final":18},company:"12345sss"},{objectId:666,name:"秋天",images:"/img/6.png",price:{origin:40,"final":32},company:"23456aaa"}]};$.extend(!0,__data.books,e),i()}),EC.on("action.addToCart",function(e,t,a,i,n,o,r){!itemData.selected.items[t]||_.isEmpty(itemData.selected.items[t])?(itemData.selected.items[t]={},$.extend(!0,itemData.selected.items[t],{id:t,name:a,originPrice:i,finalPrice:n,num:1,company:o,images:r})):itemData.selected.items[t].num+=1,itemData.total.num+=1,itemData.total.price+=n,EC.trigger("view.renderSimpleCartBar")}),EC.on("action.changeNum",function(e,t,a){switch(t){case"add":itemData.selected.items[a].num+=1,itemData.total.num+=1,itemData.total.price+=itemData.selected.items[a].finalPrice;break;case"reduce":itemData.selected.items[a].num-=1,itemData.total.num-=1,itemData.total.price-=itemData.selected.items[a].finalPrice,itemData.selected.items[a].num<=0&&(itemData.selected.items[a]={})}EC.trigger("view.renderCart")}),EC.on("view.renderList",function(){o()}),EC.on("view.renderHeader",function(){e()}),EC.on("view.renderAuthor",function(){t()}),EC.on("view.renderBooks",function(){a()}),EC.on("view.renderSimpleCartBar",function(){n()}),EC.on("view.renderCart",function(){r()}),EC.on("view.renderOrder",function(){m()});var w=function(){EC.trigger("view.renderList")},E=function(){s.hide(),EC.trigger("view.renderCart")},k=function(){c.hide(),EC.trigger("view.renderOrder")},I={"/list":w,"/cart":E,"/order":k},B=Router(I);B.init(),o()}();